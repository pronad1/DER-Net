<mxfile host="app.diagrams.net" modified="2026-02-11T00:00:00.000Z" agent="5.0" version="24.0.0" etag="YOLO11-Architecture">
  <diagram name="YOLO11-l Architecture" id="yolo11-architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3000" pageHeight="2000" math="1" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="YOLO11-large Architecture for Spine Lesion Detection" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="20" width="800" height="40" as="geometry" />
        </mxCell>
        
        <!-- Subtitle -->
        <mxCell id="subtitle" value="25.3M Parameters | 164.9 GFLOPs | 640×640 Input | 7 Classes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="800" y="60" width="800" height="25" as="geometry" />
        </mxCell>

        <!-- Input Layer -->
        <mxCell id="input" value="&lt;b&gt;Input Image&lt;/b&gt;&lt;br&gt;640×640×3&lt;br&gt;Spine X-Ray" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- ==================== BACKBONE: CSPDarknet ==================== -->
        
        <!-- Backbone Label -->
        <mxCell id="backbone-label" value="&lt;b&gt;BACKBONE: CSPDarknet with C2PSA&lt;/b&gt;" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="90" width="1200" height="30" as="geometry" />
        </mxCell>

        <!-- P1: Initial Conv -->
        <mxCell id="p1" value="&lt;b&gt;P1: Conv6×6&lt;/b&gt;&lt;br&gt;Stride: 2&lt;br&gt;SiLU Activation&lt;br&gt;320×320×64" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="280" y="130" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- P2: CSP Block -->
        <mxCell id="p2" value="&lt;b&gt;P2: CSP Block&lt;/b&gt;&lt;br&gt;Layers: 3&lt;br&gt;Conv3×3&lt;br&gt;Cross Stage Partial&lt;br&gt;160×160×128" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="460" y="130" width="140" height="110" as="geometry" />
        </mxCell>

        <!-- P3: CSP + C2PSA -->
        <mxCell id="p3" value="&lt;b&gt;P3: CSP+C2PSA&lt;/b&gt;&lt;br&gt;Layers: 6&lt;br&gt;Partial Self-Attention&lt;br&gt;Heads: 8&lt;br&gt;80×80×256" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="125" width="140" height="120" as="geometry" />
        </mxCell>

        <!-- P4: CSP + C2PSA -->
        <mxCell id="p4" value="&lt;b&gt;P4: CSP+C2PSA&lt;/b&gt;&lt;br&gt;Layers: 6&lt;br&gt;Partial Self-Attention&lt;br&gt;Heads: 8&lt;br&gt;40×40×512" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="125" width="140" height="120" as="geometry" />
        </mxCell>

        <!-- P5: CSP + C2PSA -->
        <mxCell id="p5" value="&lt;b&gt;P5: CSP+C2PSA&lt;/b&gt;&lt;br&gt;Layers: 3&lt;br&gt;Partial Self-Attention&lt;br&gt;Heads: 8&lt;br&gt;20×20×1024" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1000" y="125" width="140" height="120" as="geometry" />
        </mxCell>

        <!-- SPPF -->
        <mxCell id="sppf" value="&lt;b&gt;SPPF&lt;/b&gt;&lt;br&gt;Spatial Pyramid Pooling&lt;br&gt;MaxPool 5×5 (×3)&lt;br&gt;Concat&lt;br&gt;20×20×1024" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1180" y="125" width="160" height="120" as="geometry" />
        </mxCell>

        <!-- ==================== NECK: PANet ==================== -->
        
        <!-- Neck Label -->
        <mxCell id="neck-label" value="&lt;b&gt;NECK: Path Aggregation Network (PANet)&lt;/b&gt;" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="280" width="1060" height="30" as="geometry" />
        </mxCell>

        <!-- Upsample Path (Bottom-up) -->
        <mxCell id="upsample-label" value="&lt;b&gt;Bottom-up Pathway&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="320" width="160" height="20" as="geometry" />
        </mxCell>

        <!-- P5 -> P4 Upsample -->
        <mxCell id="up1" value="&lt;b&gt;Upsample×2&lt;/b&gt;&lt;br&gt;Concat with P4&lt;br&gt;CSPLayer&lt;br&gt;40×40×512" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="820" y="340" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- P4 -> P3 Upsample -->
        <mxCell id="up2" value="&lt;b&gt;Upsample×2&lt;/b&gt;&lt;br&gt;Concat with P3&lt;br&gt;CSPLayer&lt;br&gt;80×80×256" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="640" y="340" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- Top-down Path -->
        <mxCell id="downsample-label" value="&lt;b&gt;Top-down Pathway&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="460" width="160" height="20" as="geometry" />
        </mxCell>

        <!-- N3 Output -->
        <mxCell id="n3" value="&lt;b&gt;N3&lt;/b&gt;&lt;br&gt;Feature Level 3&lt;br&gt;80×80×256" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="480" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- P3 -> P4 Downsample -->
        <mxCell id="down1" value="&lt;b&gt;Conv3×3 s2&lt;/b&gt;&lt;br&gt;Concat&lt;br&gt;CSPLayer&lt;br&gt;40×40×512" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="820" y="480" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- N4 Output -->
        <mxCell id="n4" value="&lt;b&gt;N4&lt;/b&gt;&lt;br&gt;Feature Level 4&lt;br&gt;40×40×512" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="600" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- P4 -> P5 Downsample -->
        <mxCell id="down2" value="&lt;b&gt;Conv3×3 s2&lt;/b&gt;&lt;br&gt;Concat&lt;br&gt;CSPLayer&lt;br&gt;20×20×1024" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1000" y="480" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- N5 Output -->
        <mxCell id="n5" value="&lt;b&gt;N5&lt;/b&gt;&lt;br&gt;Feature Level 5&lt;br&gt;20×20×1024" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1000" y="600" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- ==================== DETECTION HEAD ==================== -->
        
        <!-- Head Label -->
        <mxCell id="head-label" value="&lt;b&gt;DETECTION HEAD: Decoupled Classification &amp; Regression&lt;/b&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="730" width="1060" height="30" as="geometry" />
        </mxCell>

        <!-- Head for N3 -->
        <mxCell id="head-n3-cls" value="&lt;b&gt;Classification&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;80×80×7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="560" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <mxCell id="head-n3-reg" value="&lt;b&gt;Box Regression&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;80×80×4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="690" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <!-- Head for N4 -->
        <mxCell id="head-n4-cls" value="&lt;b&gt;Classification&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;40×40×7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="740" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <mxCell id="head-n4-reg" value="&lt;b&gt;Box Regression&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;40×40×4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="870" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <!-- Head for N5 -->
        <mxCell id="head-n5-cls" value="&lt;b&gt;Classification&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;20×20×7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="920" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <mxCell id="head-n5-reg" value="&lt;b&gt;Box Regression&lt;/b&gt;&lt;br&gt;Conv3×3&lt;br&gt;Conv3×3&lt;br&gt;Conv1×1&lt;br&gt;20×20×4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1050" y="800" width="110" height="100" as="geometry" />
        </mxCell>

        <!-- DFL Head -->
        <mxCell id="dfl-head" value="&lt;b&gt;Distribution Focal Loss&lt;/b&gt;&lt;br&gt;16 bins per edge&lt;br&gt;4 edges (l,t,r,b)&lt;br&gt;Fine-grained localization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1180" y="800" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- ==================== POST-PROCESSING ==================== -->
        
        <!-- NMS -->
        <mxCell id="nms" value="&lt;b&gt;Non-Maximum Suppression&lt;/b&gt;&lt;br&gt;IoU Threshold: 0.7&lt;br&gt;Confidence: 0.25&lt;br&gt;Max Detections: 300" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;verticalAlign=middle;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="950" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- Output -->
        <mxCell id="output" value="&lt;b&gt;Final Detections&lt;/b&gt;&lt;br&gt;7 Classes:&lt;br&gt;• Osteophytes&lt;br&gt;• Surgical Implant&lt;br&gt;• Spondylolysthesis&lt;br&gt;• Foraminal Stenosis&lt;br&gt;• Disc Space Narrowing&lt;br&gt;• Vertebral Collapse&lt;br&gt;• Other Lesions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=middle;fontStyle=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="680" y="1080" width="280" height="140" as="geometry" />
        </mxCell>

        <!-- ==================== ARROWS/CONNECTIONS ==================== -->
        
        <!-- Input to P1 -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="input" target="p1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P1 to P2 -->
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="p1" target="p2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P2 to P3 -->
        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="p2" target="p3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P3 to P4 -->
        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="p3" target="p4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P4 to P5 -->
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="p4" target="p5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P5 to SPPF -->
        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="p5" target="sppf">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- SPPF to Upsample -->
        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="sppf" target="up1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Up1 to Up2 -->
        <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="up1" target="up2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P3 to Up2 (lateral connection) -->
        <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="p3" target="up2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P4 to Up1 (lateral connection) -->
        <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="p4" target="up1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Up2 to N3 -->
        <mxCell id="arrow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="up2" target="n3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- N3 to Down1 -->
        <mxCell id="arrow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="n3" target="down1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Down1 to N4 -->
        <mxCell id="arrow13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="down1" target="n4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- N4 to Down2 -->
        <mxCell id="arrow14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="n4" target="down2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Down2 to N5 -->
        <mxCell id="arrow15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="down2" target="n5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- N3 to Heads -->
        <mxCell id="arrow16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n3" target="head-n3-cls">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n3" target="head-n3-reg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- N4 to Heads -->
        <mxCell id="arrow18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n4" target="head-n4-cls">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n4" target="head-n4-reg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- N5 to Heads -->
        <mxCell id="arrow20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n5" target="head-n5-cls">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="n5" target="head-n5-reg">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Heads to NMS -->
        <mxCell id="arrow22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="head-n3-cls" target="nms">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="head-n4-cls" target="nms">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#d6b656;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="head-n5-cls" target="nms">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- NMS to Output -->
        <mxCell id="arrow25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="nms" target="output">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ==================== C2PSA DETAIL BOX ==================== -->
        
        <mxCell id="c2psa-detail-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;dashPattern=8 8;" vertex="1" parent="1">
          <mxGeometry x="1420" y="125" width="520" height="520" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-title" value="&lt;b&gt;C2PSA Module Detail&lt;/b&gt;&lt;br&gt;(CSP with Partial Self-Attention)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1520" y="135" width="320" height="35" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-input" value="&lt;b&gt;Input Feature Map&lt;/b&gt;&lt;br&gt;H×W×C" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1620" y="185" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-split" value="&lt;b&gt;Channel Split&lt;/b&gt;&lt;br&gt;ratio = 0.5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1620" y="255" width="120" height="45" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-part1" value="&lt;b&gt;Part 1&lt;/b&gt;&lt;br&gt;C/2 channels&lt;br&gt;(Identity)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1460" y="320" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-part2" value="&lt;b&gt;Part 2&lt;/b&gt;&lt;br&gt;C/2 channels" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1780" y="320" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-bottleneck" value="&lt;b&gt;2× Bottleneck&lt;/b&gt;&lt;br&gt;Conv1×1→Conv3×3→Conv1×1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1760" y="400" width="140" height="50" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-concat1" value="&lt;b&gt;Concat&lt;/b&gt;&lt;br&gt;[Part2 + Bottleneck outputs]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1760" y="470" width="140" height="45" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-attention" value="&lt;b&gt;Multi-Head Self-Attention&lt;/b&gt;&lt;br&gt;Heads: 8&lt;br&gt;Q, K, V = Linear(F_partial)&lt;br&gt;Attn = Softmax(QK^T/√d_k)V" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1730" y="535" width="200" height="70" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-proj" value="&lt;b&gt;Projection&lt;/b&gt;&lt;br&gt;Conv1×1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1760" y="620" width="100" height="40" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-concat2" value="&lt;b&gt;Concat [Part1, Proj]&lt;/b&gt;&lt;br&gt;CSP Connection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1560" y="580" width="140" height="50" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-output" value="&lt;b&gt;Output&lt;/b&gt;&lt;br&gt;Conv1×1&lt;br&gt;H×W×C" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1590" y="675" width="100" height="55" as="geometry" />
        </mxCell>

        <!-- C2PSA Arrows -->
        <mxCell id="c2psa-arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-input" target="c2psa-split">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-split" target="c2psa-part1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-split" target="c2psa-part2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-part2" target="c2psa-bottleneck">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-bottleneck" target="c2psa-concat1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-concat1" target="c2psa-attention">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-attention" target="c2psa-proj">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;dashed=1;" edge="1" parent="1" source="c2psa-part1" target="c2psa-concat2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="c2psa-arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-proj" target="c2psa-concat2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1810" y="640" />
              <mxPoint x="1810" y="660" />
              <mxPoint x="1630" y="660" />
              <mxPoint x="1630" y="620" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="c2psa-arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="c2psa-concat2" target="c2psa-output">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ==================== LOSS FUNCTION BOX ==================== -->
        
        <mxCell id="loss-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;dashPattern=8 8;" vertex="1" parent="1">
          <mxGeometry x="1420" y="700" width="520" height="520" as="geometry" />
        </mxCell>

        <mxCell id="loss-title" value="&lt;b&gt;Loss Function Components&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1520" y="710" width="320" height="30" as="geometry" />
        </mxCell>

        <mxCell id="loss-ciou" value="&lt;b&gt;Complete IoU Loss&lt;/b&gt;&lt;br&gt;L_box = 1 - CIoU(b, b̂)&lt;br&gt;• IoU term&lt;br&gt;• Center distance penalty&lt;br&gt;• Aspect ratio consistency&lt;br&gt;Weight: λ_box = 7.5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1460" y="760" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="loss-focal" value="&lt;b&gt;Focal Loss&lt;/b&gt;&lt;br&gt;L_cls = -α(1-p)^γ log(p)&lt;br&gt;• Focusing parameter: γ=2.0&lt;br&gt;• Class balance: α=0.25&lt;br&gt;• Down-weights easy examples&lt;br&gt;Weight: λ_cls = 0.5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1700" y="760" width="210" height="120" as="geometry" />
        </mxCell>

        <mxCell id="loss-dfl" value="&lt;b&gt;Distribution Focal Loss&lt;/b&gt;&lt;br&gt;L_dfl = -Σ P(y,k) log(P̂(y,k))&lt;br&gt;• Fine-grained box refinement&lt;br&gt;• 16 bins per edge&lt;br&gt;• 4 edges: left, top, right, bottom&lt;br&gt;Weight: λ_dfl = 1.5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1460" y="910" width="220" height="120" as="geometry" />
        </mxCell>

        <mxCell id="loss-total" value="&lt;b&gt;Total Loss&lt;/b&gt;&lt;br&gt;&lt;br&gt;L_total = 7.5×L_box + 0.5×L_cls + 1.5×L_dfl&lt;br&gt;&lt;br&gt;Optimized with AdamW&lt;br&gt;• lr = 1×10^-4&lt;br&gt;• Weight decay = 5×10^-4&lt;br&gt;• Cosine annealing schedule" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=1;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="1700" y="910" width="230" height="150" as="geometry" />
        </mxCell>

        <mxCell id="loss-equation" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;Task-Aligned Assignment:&lt;/b&gt;&lt;br&gt;t_align = (cls_score)^0.5 × (IoU_score)^0.6&lt;br&gt;Top-k selection with dynamic IoU threshold&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;align=left;" vertex="1" parent="1">
          <mxGeometry x="1460" y="1060" width="470" height="60" as="geometry" />
        </mxCell>

        <mxCell id="training-stats" value="&lt;b&gt;Training Configuration&lt;/b&gt;&lt;br&gt;• Epochs: 50 (early stop patience=25)&lt;br&gt;• Batch size: 12&lt;br&gt;• Input size: 640×640&lt;br&gt;• Mixed precision (FP16)&lt;br&gt;• Gradient clipping: 10.0&lt;br&gt;• Data augmentation: Mosaic, Copy-Paste, HSV" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=9;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1460" y="1140" width="470" height="70" as="geometry" />
        </mxCell>

        <!-- ==================== LEGEND ==================== -->
        
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="100" y="280" width="140" height="420" as="geometry" />
        </mxCell>

        <mxCell id="legend-title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="285" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="legend-backbone" value="Backbone Layers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="320" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-c2psa" value="C2PSA Blocks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="360" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-neck" value="Neck (PANet)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="400" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-cls" value="Classification Head" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="440" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-reg" value="Regression Head" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="480" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-sppf" value="SPPF Module" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="520" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-dfl" value="DFL / Post-process" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="560" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-output" value="Output / NMS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="600" width="120" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend-arrow" value="Feature Flow →" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="640" width="90" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-arrow-line" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#6c8ebf;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="650" as="sourcePoint" />
            <mxPoint x="230" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-skip" value="Skip Connection - - -" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="665" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- ==================== PARAMETERS INFO ==================== -->
        
        <mxCell id="params-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="100" y="750" width="140" height="210" as="geometry" />
        </mxCell>

        <mxCell id="params-title" value="&lt;b&gt;Model Statistics&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="755" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="params-info" value="&lt;b&gt;Parameters:&lt;/b&gt;&lt;br&gt;• Backbone: 17.8M&lt;br&gt;• Neck: 5.6M&lt;br&gt;• Head: 1.9M&lt;br&gt;• &lt;b&gt;Total: 25.3M&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;Computation:&lt;/b&gt;&lt;br&gt;• FLOPs: 164.9G&lt;br&gt;• Memory: 6.2GB&lt;br&gt;&lt;br&gt;&lt;b&gt;Performance:&lt;/b&gt;&lt;br&gt;• Speed: ~45 FPS&lt;br&gt;• Device: RTX 3050" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="110" y="785" width="120" height="165" as="geometry" />
        </mxCell>

        <!-- ==================== FOOTER ==================== -->
        
        <mxCell id="footer" value="YOLO11-l: Anchor-Free Detection with Task-Aligned Assignment | Dataset: VinDr-SpineXR (8,389 images) | 7 Pathological Classes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="300" y="1250" width="1200" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
